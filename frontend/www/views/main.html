<script src="js/OpenFB.js"></script>
<div class="container-fluid" id="homeScreen">
    <div class="background background-normal">

        <div class="appNameFrontScreen">Dr. Smoothie</div>
        <div class="btnHomePage" id="btnLogin">
            <a onclick="login()" type="button" class="btn btn-primary btn-lg btn-block">Login with Facebook</a>
        </div>
       <!-- <div class="btnHomePage" id="btnHome">
            <a ng-href="#/search" type="button" class="btn btn-primary btn-lg btn-block">Search</a>
        </div>
        <div class="btnHomePage" id="btnHomeRecipes">
            <a ng-href="#/smoothieListPersonal" type="button" class="btn btn-default btn-lg btn-block">Recipes</a>
        </div>
        <div class="btnHomePage" id="btnHomeCreateSmootie">
            <a ng-href="#/create" type="button" class="btn btn-primary btn-lg btn-block">Create Smoothie</a>
        </div>-->
        <div id="userInfo" align="center">
            <div id="username">Hi</div>
            <img id="imgProfilePic" class="fbProfilePicture" src="" /><br /><br />
        </div>
    </div>
</div>

<script>
var homeURL = "#/smoothieListPersonal";
$("#btnLogin").hide();
$("#userInfo").hide();

// Defaults to sessionStorage for storing the Facebook token
//openFB.init({
//    appId: '1447784508842506'
//});
// Uncomment the line below to store the Facebook token in localStorage instead of sessionStorage
openFB.init({appId: '1447784508842506', tokenStore: window.localStorage});

// check if the user is already logged into Facebook
openFB.getLoginStatus (function (param) {
    console.log(param);
    if (param.status == "connected") {

        getInfo(function () {
            $("#userInfo").show().animate({}, 1000);
            redirectToHomePage(2000);
        });
    }

    if (param.status == "unknown") {
        $("#btnLogin").show().animate({}, 1000);
    }
});

function redirectToHomePage(duration) {
    setTimeout( function () {
        window.location.href=homeURL;
    }, duration);
}

function login() {
    openFB.login(
        function(response) {
            if (response.status === 'connected') {
                //alert('Facebook login succeeded');
                redirectToHomePage(2000);

            } else {
                alert('Facebook login failed!');
                location.reload();
            }
        }, {
            scope: 'email,read_stream,publish_stream'
        });
}



function getInfo(callback) {
    openFB.api({
        path: '/me',
        success: function(data) {
            console.log(JSON.stringify(data));
            $("#username").text("Hi "+ data.first_name+" !");
            $("#imgProfilePic").attr("src", 'http://graph.facebook.com/' + data.id + '/picture?type=normal');
            callback();
        },
        error: errorHandler
    });
}

function share() {
    openFB.api({
        method: 'POST',
        path: '/me/feed',
        params: {
            message: document.getElementById('Message').value || 'Testing Facebook APIs'
        },
        success: function() {
            alert('the item was posted on Facebook');
        },
        error: errorHandler
    });
}

function revoke() {
    openFB.revokePermissions(
        function() {
            alert('Permissions revoked');
        },
        errorHandler);
}

function logout() {
    openFB.logout(
        function() {
            alert('Logout successful');
        },
        errorHandler);
}

function errorHandler(error) {
    alert(error.message);
}
</script>